(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[882],{355:function(e,t,n){Promise.resolve().then(n.bind(n,6348))},6348:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return m}});var r=n(7437),s=n(2265),i=n(9376),a=n(2381),c=n(8793),l=n.n(c);let o=()=>{let[e,t]=(0,s.useState)(null),[n,r]=(0,s.useState)(!1),[i,a]=(0,s.useState)(null);return(0,s.useEffect)(()=>{let e=new(l())("f2cc2cf57fa2a327f579",{cluster:"eu"}),n=e.subscribe("my-channel");return n.bind("my-event",e=>{t(e.message),r(!0)}),e.connection.bind("error",e=>{console.error("Pusher connection error:",e),a(e),r(!1)}),e.connection.bind("connected",()=>{r(!0)}),e.connection.bind("disconnected",()=>{r(!1)}),()=>{n.unbind_all(),e.unsubscribe("my-channel"),e.disconnect()}},[]),{message:e,isConnected:n,error:i}},d=e=>{let[t,n]=(0,s.useState)(!1),r=(0,s.useRef)(null);return{isRecording:t,startRecording:async()=>{let t=new MediaRecorder(await navigator.mediaDevices.getUserMedia({audio:!0}));r.current=t,t.ondataavailable=t=>{e(t.data)},t.start(),n(!0)},stopRecording:()=>{r.current&&(r.current.stop(),n(!1))}}};var u=n(279);function f(e){let{onFilesChange:t}=e,[n,i]=(0,s.useState)([]),[a,c]=(0,s.useState)([]);return(0,r.jsxs)("div",{className:"w-full max-w-2xl",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold",children:"Images"}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)(u.I,{type:"file",multiple:!0,onChange:e=>{if(e.target.files){let n=Array.from(e.target.files);i(e=>{let r=[...e,...n];return t(r),r});let r=n.map(e=>URL.createObjectURL(e));c(e=>[...e,...r])}}})}),(0,r.jsx)("div",{className:"mt-4 grid grid-cols-3 gap-4",children:a.map((e,t)=>(0,r.jsx)("img",{src:e,alt:"preview ".concat(t),className:"w-full h-auto"},t))})]})}function m(){let e=(0,i.useRouter)(),{isConnected:t,error:n,socket:c}=o(),[l,u]=(0,s.useState)(""),[m,g]=(0,s.useState)([]),{isRecording:x,startRecording:b,stopRecording:h}=d(e=>{c&&c.readyState===WebSocket.OPEN&&c.send(e)});(0,s.useEffect)(()=>{c&&(c.onmessage=e=>{let t=JSON.parse(e.data);t.transcript&&u(e=>e+t.transcript)})},[c]);let p=async()=>{let t=new FormData;t.append("transcription",l),m.forEach(e=>{t.append("images",e)});let n=await fetch("/api/generate-article",{method:"POST",body:t}),r=await n.json();e.push("/article?article=".concat(r.article))};return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen p-8",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold",children:"Enregistrement en cours..."}),(0,r.jsxs)("p",{className:"mt-4 text-lg",children:["\xc9tat de la connexion: ",t?"Connect\xe9":"D\xe9connect\xe9"]}),n&&(0,r.jsxs)("p",{className:"text-red-500",children:["Erreur: ",JSON.stringify(n)]}),(0,r.jsx)("div",{className:"mt-8",children:(0,r.jsx)(a.z,{onClick:()=>{x?h():b()},size:"lg",disabled:!t,children:x?"Arr\xeater l'enregistrement":"Commencer l'enregistrement"})}),(0,r.jsxs)("div",{className:"mt-8 w-full max-w-2xl",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold",children:"Transcription"}),(0,r.jsx)("p",{className:"mt-4 text-lg",children:l})]}),(0,r.jsx)("div",{className:"mt-8 w-full max-w-2xl",children:(0,r.jsx)(f,{onFilesChange:g})}),(0,r.jsx)("div",{className:"mt-8",children:(0,r.jsx)(a.z,{onClick:p,size:"lg",disabled:!l,children:"G\xe9n\xe9rer l'article"})})]})}},2381:function(e,t,n){"use strict";n.d(t,{z:function(){return o}});var r=n(7437),s=n(2265),i=n(7053),a=n(535),c=n(3448);let l=(0,a.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=s.forwardRef((e,t)=>{let{className:n,variant:s,size:a,asChild:o=!1,...d}=e,u=o?i.g7:"button";return(0,r.jsx)(u,{className:(0,c.cn)(l({variant:s,size:a,className:n})),ref:t,...d})});o.displayName="Button"},279:function(e,t,n){"use strict";n.d(t,{I:function(){return a}});var r=n(7437),s=n(2265),i=n(3448);let a=s.forwardRef((e,t)=>{let{className:n,type:s,...a}=e;return(0,r.jsx)("input",{type:s,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),ref:t,...a})});a.displayName="Input"},3448:function(e,t,n){"use strict";n.d(t,{cn:function(){return i}});var r=n(1994),s=n(3335);function i(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,s.m6)((0,r.W)(t))}}},function(e){e.O(0,[569,280,971,117,744],function(){return e(e.s=355)}),_N_E=e.O()}]);